---
title: "Assigment - kNN DIY"
author:
- "Emiel Maters - 634735 - Author"
- "name reviewer here - Reviewer"
date: "`r format(Sys.time(), '%d %B, %Y')`"
output:
  html_document:
    toc: yes
    toc_depth: '2'
    df_print: paged
  html_notebook:
    toc: yes
    toc_depth: 2
bibliography: references.bib
---

------------------------------------------------------------------------

Choose a suitable dataset from [this](https://github.com/HAN-M3DM-Data-Mining/assignments/tree/master/datasets) folder and train your own kNN model. Follow all the steps from the CRISP-DM model.

## Set-up

Before we can start with this assignment the installation and activation of some packages is needed:

```{r}
library(tidyverse)
library(dplyr)
library(janitor)
library(googlesheets4)
library(class)
library(caret)
```

## Business Understanding

This assignment is based on the data and story of Georg Hoffmann, Andreas Bietenbeck, Ralf Lichtinghagen and Frank Klawonn [@hoffmann2018].

When laboratory have to make a diagnose, their way of making decisions is based on rules: "If...then...else". This way of diagnosing can be seen as a decision tree. Those treebranches can be seen as established medical guidelines that lead at some point to a diagnosis, like shown in the example down below.

![Example of an established diagnostic pathway for the differential diagnosis of anemia](images/paste-C0185445.png){#hemoglobin}

This data problem is about creating a KNN model that can determine in what stage a patient is:

-   C0 = Blood Donor
-   C1 = hepatitis without fibrosis or with only minor signs of portal fibrosis
-   C2 = therapy-relevant fibrosis
-   C3 = LTX-relevant end stage liver cirrhosis

The data for this study is based on 73 patients (53 males, 22 females), aged 19 to 75 years (median 50), with a proven serological and histopathological diagnosis of hepatitis C. Who have suffer a chronic hepatitis C infection without fibrosis to end stage liver cirrhosis with a need for liver transplantation (LTX).

In this assignment will first be tested whether the kNN model can seperate the stages: C1, C2 and C3. After that it will be researched how the model performs if data from Blood Donors is added.

## Data Understanding

As said, this data comes from an open source data set from Georg Hoffmann, Andreas Bietenbeck, Ralf Lichtinghagen and Frank Klawonn [@hoffmann2018]. In the next code is the data written to a table called NewData.

```{r}
NewData<-read_csv("datasets/KNN-hcvdat0.csv")
```

### Properties of the data

This section covers the properties of the dataset, without having made any changes to it.

```{r}
str(NewData)
```

As we can see above, the dataframe consists of twelve columns that consists of a numeric data and two columns have characteristic data. In total the data set contains 615 observations (rows).

The data set is distinguished by the variable `Category`. So the health-state of the patients is viewed as `Category`. Down below is given that the majority of the data set consists of Blood Donors.

```{r}
cat("Categroy by Sex summary","\n\n")
NewData %>% 
  tabyl(Category, Sex)
cat("\n\n","Age summary","\n\n")
summary(NewData$Age)
  
```

## Data Preparation

At first, we copy the original dataset to a new data frame so if a error is made, the original data won't be messed up.

```{r}
Cleaned_data<-NewData
```

The kNN model is at its best when al values are in the same range. So as we can see down below, the minimum and maximum values can differ a lot:

```{r}
summary(Cleaned_data)
```

So for that reason the data has to be normalized. This can be achieved via the normalization function. The normalization function sets the highest value as a "1" and the lowest value as a "0". It then will proportionally scale the original values between the 0 and 1.

```{r}
Normalize <- function(x){return((x-min(x))/(max(x)-min(x)))}
```

```{r}
num_of_columns <- dim(Cleaned_data)[2] #get number of columns, 2 stands for second value which represents the column count.
Cleaned_data_n <- sapply(5:num_of_columns, function(x){Normalize(Cleaned_data[,x])}) #start the normalization from 5th column

```

For this model are the data input of `Blood Donor` and `suspect Blood Donor` not mandatory, so they will be removed from the dataset.

```{r}
summary(Cleaned_data_n)
```

## Modeling

text and code here

## Evaluation and Deployment

text and code here

reviewer adds suggestions for improving the model

## Bibliography
