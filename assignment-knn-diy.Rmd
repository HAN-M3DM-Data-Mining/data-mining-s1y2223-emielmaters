---
title: "Assigment - kNN DIY"
author:
- "Emiel Maters - 634735 - Author"
- "name reviewer here - Reviewer"
date: "`r format(Sys.time(), '%d %B, %Y')`"
output:
  html_document:
    toc: yes
    toc_depth: '2'
    df_print: paged
  html_notebook:
    toc: yes
    toc_depth: 2
bibliography: references.bib
---

------------------------------------------------------------------------

Choose a suitable dataset from [this](https://github.com/HAN-M3DM-Data-Mining/assignments/tree/master/datasets) folder and train your own kNN model. Follow all the steps from the CRISP-DM model.

# Set-up

Before we can start with this assignment the installation and activation of some packages is needed:

```{r}
library(tidyverse)
library(dplyr)
library(janitor)
library(googlesheets4)
library(class)
library(caret)
```

# Business Understanding

This assignment is based on the data and story of Georg Hoffmann, Andreas Bietenbeck, Ralf Lichtinghagen and Frank Klawonn [@hoffmann2018].

When laboratory have to make a diagnose, their way of making decisions is based on rules: "If...then...else". This way of diagnosing can be seen as a decision tree. Those treebranches can be seen as established medical guidelines that lead at some point to a diagnosis, like shown in the example down below.

![Example of an established diagnostic pathway for the differential diagnosis of anemia](images/paste-C0185445.png){#hemoglobin}

## Data question

This data problem is about creating a KNN model that can determine in what stage a patient is:

-   C0 = Blood Donor
-   C1 = hepatitis without fibrosis or with only minor signs of portal fibrosis
-   C2 = therapy-relevant fibrosis
-   C3 = LTX-relevant end stage liver cirrhosis

The data for this study is based on 73 patients (53 males, 22 females), aged 19 to 75 years (median 50), with a proven serological and histopathological diagnosis of hepatitis C. Who have suffer a chronic hepatitis C infection without fibrosis to end stage liver cirrhosis with a need for liver transplantation (LTX).

In this assignment will first be tested whether the kNN model can seperate the stages: C1, C2 and C3. After that it will be researched how the model performs if data from Blood Donors is added.

# Data Understanding

As said, this data comes from an open source data set from Georg Hoffmann, Andreas Bietenbeck, Ralf Lichtinghagen and Frank Klawonn [@hoffmann2018]. In the next code is the data written to a table called NewData.

```{r}
NewData<-read_csv("datasets/KNN-hcvdat0.csv")
```

## Properties of the data

This section covers the properties of the dataset, without having made any changes to it.

```{r}
str(NewData)
```

As we can see above, the dataframe consists of twelve columns that consists of a numeric data and two columns have characteristic data. In total the data set contains 615 observations (rows).

### Data summary

The data set is distinguished by the variable `Category`. So the health-state of the patients is viewed as `Category`. Down below is given that the majority of the data set consists of Blood Donors. It also shows that the youngest person is 19 years old and the oldest person is 77 years.

```{r echo=FALSE, fig.width=50}
cat("Category by Sex - summary","\n\n")
NewData %>% 
  tabyl(Category, Sex)
cat("Age summary","\n\n")
summary(NewData$Age)
  
```

# Data Preparation

## Creating a new editable data set

At first, we copy the original dataset to a new data frame so if a error is made, the original data won't be messed up.

```{r}
Raw_data<-NewData
```

## Tweaking the data

The kNN model is at its best when al values are in the same range. So as we can see down below, the minimum and maximum values can differ a lot and there are also some missing values. This can be solved by normalizing and deleting the observations.

```{r}
summary(Raw_data)
```

### Deleting missing values

```{r}
Cleaned_data_na<-na.omit(Raw_data)
summary(Cleaned_data_na)
```

### Exclude columns

For the first model is the data input of `Blood Donor` and `suspect Blood Donor` not needed, so they can be removed from the dataset. Also the index column "...1" is not needed. This dataset will be called `Cleaned_data_na_cr`.

```{r}
Cleaned_data_na_c<-select(Cleaned_data_na, -...1)
Cleaned_data_na_c_r<-filter(Cleaned_data_na_c, Category!="0=Blood Donor"&Category!="0s=suspect Blood Donor")

Cleaned_data_na_c_r %>%
  head()
```

### Normalizing the data

So now the data has to be normalized, only this wat the kNN model can work properly. Otherwise some variables could take overhand by having relatively high values. This can be achieved via the normalization function. The normalization function sets the highest value as a "1" and the lowest value as a "0". It then will proportionally scale the original values between the 0 and 1.

#### Setting up the normalize fuction

```{r}
Normalize <- function(x){return((x-min(x))/(max(x)-min(x)))}
```

#### Write the normalized values to a new table

```{r}
num_of_columns <- dim(Cleaned_data_na_c_r)[2] #get number of columns, 2 stands for second value which represents the column count.
Cleaned_data_na_c_r_n <- sapply(4:num_of_columns, function(x){Normalize(Cleaned_data_na_c_r[,x])}) #start the normalization from 5th column

```

In this summary is clearly visible that there are no missing values (NA's) and all the values are between "0" and "1".

```{r}
summary(as_tibble(Cleaned_data_na_c_r_n))
```

In conclusion, the dataset `Cleaned_data_na_c_r_n`, has no missing values, not needed columns and rows were deleted and all numbers are normalized.

# Modeling

text and code here

# Evaluation and Deployment

text and code here

reviewer adds suggestions for improving the model

# Bibliography
